{% extends 'base.html' %}

{% block title %}{{ podcast.title }} - LearnAI{% endblock %}

{% block content %}
<section class="view-podcast-section">
    <div class="container">
        <!-- Back Link -->
        <a href="{% url 'podcasts' %}" class="back-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
            Back to Podcasts
        </a>

        <!-- Header -->
        <div class="podcast-header">
            <div class="podcast-header-info">
                <h1>{{ podcast.title }}</h1>
                <div class="podcast-meta">
                    <span class="meta-badge level-{{ podcast.level }}">{{ podcast.level_label }}</span>
                    <span class="meta-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                            <line x1="16" y1="2" x2="16" y2="6" />
                            <line x1="8" y1="2" x2="8" y2="6" />
                            <line x1="3" y1="10" x2="21" y2="10" />
                        </svg>
                        {{ podcast.created_at|date:"M d, Y" }}
                    </span>
                    <span class="meta-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                            <polyline points="14,2 14,8 20,8" />
                        </svg>
                        From: {{ podcast.document.title }}
                    </span>
                </div>
            </div>
        </div>

        <div class="podcast-view-layout">
            <!-- Audio Player Card -->
            <div class="player-section">
                <div class="player-card">
                    <div class="player-visual-bar">
                        <div class="player-avatar alex-avatar">
                            <span>A</span>
                        </div>
                        <div class="player-wave-bars">
                            <span></span><span></span><span></span><span></span><span></span>
                            <span></span><span></span><span></span><span></span><span></span>
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>
                        <div class="player-avatar sam-avatar">
                            <span>S</span>
                        </div>
                    </div>

                    <div class="player-hosts">
                        <span class="host-label alex-label">üéôÔ∏è Alex</span>
                        <span class="host-label sam-label">üéß Sam</span>
                    </div>

                    {% if podcast.audio_file %}
                    <audio controls id="audioPlayer" style="width: 100%;">
                        <source src="{{ podcast.audio_file.url }}" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>

                    <div class="player-actions">
                        <a href="{% url 'download_podcast' podcast.id %}" class="btn btn-primary btn-action">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                <polyline points="7 10 12 15 17 10" />
                                <line x1="12" y1="15" x2="12" y2="3" />
                            </svg>
                            Download MP3
                        </a>
                        <a href="{% url 'podcasts' %}" class="btn btn-outline btn-action">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <line x1="12" y1="8" x2="12" y2="16" />
                                <line x1="8" y1="12" x2="16" y2="12" />
                            </svg>
                            Generate Another
                        </a>
                    </div>
                    {% else %}
                    <p class="no-audio">Audio file is not available for this podcast.</p>
                    {% endif %}
                </div>

                <!-- Podcast Info Card -->
                <div class="info-card">
                    <h3>Podcast Details</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Source Document</span>
                            <span class="info-value">{{ podcast.document.title }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Depth Level</span>
                            <span class="info-value">{{ podcast.get_level_display }}</span>
                        </div>

                        <div class="info-item">
                            <span class="info-label">Generated</span>
                            <span class="info-value">{{ podcast.created_at|date:"M d, Y H:i" }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Generation Time</span>
                            <span class="info-value">{{ podcast.generation_time|floatformat:1 }}s</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">AI Model</span>
                            <span class="info-value">{{ podcast.model_used }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Script Section -->
            <div class="script-section">
                <div class="script-card">
                    <div class="script-header">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                <polyline points="14,2 14,8 20,8" />
                            </svg>
                            Podcast Script
                        </h3>
                        <span class="script-count">{{ script_lines|length }} lines</span>
                    </div>

                    <div class="script-body">
                        {% for line in script_lines %}
                        <div class="script-line">
                            {% if line.speaker == 'alex' %}
                            <div class="speaker-badge alex-badge">
                                <span class="speaker-dot alex-dot"></span>
                                Alex
                            </div>
                            {% elif line.speaker == 'sam' %}
                            <div class="speaker-badge sam-badge">
                                <span class="speaker-dot sam-dot"></span>
                                Sam
                            </div>
                            {% endif %}
                            <p class="line-text">{{ line.text }}</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
    .view-podcast-section {
        padding: 7rem 0 4rem;
        min-height: 100vh;
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-secondary);
        text-decoration: none;
        margin-bottom: 1.5rem;
        font-size: 0.9rem;
        transition: color var(--transition-fast);
    }

    .back-link:hover {
        color: var(--accent-primary);
    }

    /* Header */
    .podcast-header {
        margin-bottom: 2rem;
    }

    .podcast-header h1 {
        font-size: 2rem;
        margin-bottom: 0.75rem;
    }

    .podcast-meta {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 1rem;
    }

    .meta-badge {
        padding: 0.3rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .level-beginner {
        background: rgba(34, 197, 94, 0.15);
        color: #22c55e;
    }

    .level-intermediate {
        background: rgba(234, 179, 8, 0.15);
        color: #eab308;
    }

    .level-advanced {
        background: rgba(239, 68, 68, 0.15);
        color: #ef4444;
    }

    .meta-item {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        color: var(--text-secondary);
        font-size: 0.85rem;
    }

    /* Layout */
    .podcast-view-layout {
        display: grid;
        grid-template-columns: 400px 1fr;
        gap: 2rem;
        align-items: start;
    }

    /* Player Section */
    .player-section {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        position: sticky;
        top: 6rem;
    }

    .player-card {
        background: var(--gradient-card);
        border: 1px solid var(--glass-border);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
    }

    .player-visual-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .player-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1rem;
        flex-shrink: 0;
    }

    .alex-avatar {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
    }

    .sam-avatar {
        background: linear-gradient(135deg, #a78bfa, #7c3aed);
        color: white;
    }

    .player-wave-bars {
        display: flex;
        align-items: end;
        gap: 2px;
        height: 30px;
        flex-grow: 1;
        max-width: 200px;
        justify-content: center;
    }

    .player-wave-bars span {
        display: block;
        width: 3px;
        border-radius: 2px;
        background: linear-gradient(to top, var(--accent-primary), #a78bfa);
        animation: soundbar 1.2s ease-in-out infinite;
    }

    .player-wave-bars span:nth-child(1) {
        height: 30%;
        animation-delay: 0s;
    }

    .player-wave-bars span:nth-child(2) {
        height: 55%;
        animation-delay: 0.08s;
    }

    .player-wave-bars span:nth-child(3) {
        height: 80%;
        animation-delay: 0.16s;
    }

    .player-wave-bars span:nth-child(4) {
        height: 40%;
        animation-delay: 0.24s;
    }

    .player-wave-bars span:nth-child(5) {
        height: 95%;
        animation-delay: 0.32s;
    }

    .player-wave-bars span:nth-child(6) {
        height: 50%;
        animation-delay: 0.4s;
    }

    .player-wave-bars span:nth-child(7) {
        height: 70%;
        animation-delay: 0.48s;
    }

    .player-wave-bars span:nth-child(8) {
        height: 35%;
        animation-delay: 0.56s;
    }

    .player-wave-bars span:nth-child(9) {
        height: 85%;
        animation-delay: 0.64s;
    }

    .player-wave-bars span:nth-child(10) {
        height: 45%;
        animation-delay: 0.72s;
    }

    .player-wave-bars span:nth-child(11) {
        height: 60%;
        animation-delay: 0.8s;
    }

    .player-wave-bars span:nth-child(12) {
        height: 90%;
        animation-delay: 0.88s;
    }

    .player-wave-bars span:nth-child(13) {
        height: 38%;
        animation-delay: 0.96s;
    }

    .player-wave-bars span:nth-child(14) {
        height: 75%;
        animation-delay: 1.04s;
    }

    .player-wave-bars span:nth-child(15) {
        height: 55%;
        animation-delay: 1.12s;
    }

    @keyframes soundbar {

        0%,
        100% {
            transform: scaleY(0.4);
            opacity: 0.5;
        }

        50% {
            transform: scaleY(1);
            opacity: 1;
        }
    }

    .player-hosts {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1rem;
    }

    .host-label {
        font-size: 0.8rem;
        font-weight: 600;
    }

    .alex-label {
        color: #60a5fa;
    }

    .sam-label {
        color: #a78bfa;
    }

    audio {
        width: 100%;
        border-radius: var(--radius-md);
        outline: none;
        margin-bottom: 1rem;
    }

    .player-actions {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .btn-action {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        text-decoration: none;
        width: 100%;
    }

    .no-audio {
        text-align: center;
        color: var(--text-secondary);
        padding: 1rem;
    }

    /* Info Card */
    .info-card {
        background: var(--gradient-card);
        border: 1px solid var(--glass-border);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
    }

    .info-card h3 {
        margin-bottom: 1rem;
        font-size: 1rem;
    }

    .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
    }

    .info-item {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
    }

    .info-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .info-value {
        font-size: 0.9rem;
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Script Section */
    .script-card {
        background: var(--gradient-card);
        border: 1px solid var(--glass-border);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
    }

    .script-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--glass-border);
    }

    .script-header h3 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0;
        font-size: 1.1rem;
    }

    .script-count {
        font-size: 0.8rem;
        color: var(--text-secondary);
        background: var(--bg-tertiary);
        padding: 0.2rem 0.6rem;
        border-radius: 12px;
    }

    .script-body {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .script-line {
        padding: 0.75rem 1rem;
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        border-left: 3px solid transparent;
        transition: all var(--transition-fast);
    }

    .script-line:hover {
        transform: translateX(4px);
    }

    .script-line:has(.alex-badge) {
        border-left-color: #3b82f6;
    }

    .script-line:has(.sam-badge) {
        border-left-color: #a78bfa;
    }

    .speaker-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.3rem;
    }

    .speaker-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
    }

    .alex-dot {
        background: #3b82f6;
    }

    .sam-dot {
        background: #a78bfa;
    }

    .alex-badge {
        color: #60a5fa;
    }

    .sam-badge {
        color: #c4b5fd;
    }

    .line-text {
        margin: 0;
        font-size: 0.95rem;
        line-height: 1.6;
        color: var(--text-primary);
    }

    /* Responsive */
    @media (max-width: 992px) {
        .podcast-view-layout {
            grid-template-columns: 1fr;
        }

        .player-section {
            position: static;
        }

        .info-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}